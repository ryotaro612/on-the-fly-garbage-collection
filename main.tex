% A cheat sheet
% https://www.cpt.univ-mrs.fr/~masson/latex/Beamer-appearance-cheat-sheet.pdf
% ptは細かい指定はできないらしい
\documentclass[unicode, 14pt, aspectratio=169]{beamer}
\usetheme{titech}
\addbibresource{main.bib}
\date{\today}
\title{Goのガベージコレクション}
\author{\texttt{ryotaro612}}
\newcommand\blfootnote[1]{%
  \begingroup
  \renewcommand\thefootnote{}\footnote{#1}%
  \addtocounter{footnote}{-1}%
  \endgroup
}
\begin{document}
\begin{frame}[noframenumbering, plain]
\titlepage
\end{frame}
\section{ランタイム}
\begin{frame}
  \frametitle{Goのガベージコレクション}
  {\large concurrent, tri-color, mark-sweep collector\supercite{go15gc}}
  \begin{itemize}
  \item 原典は、DijkstraとLamportによるOn-the-Fly Garbage Collection: An Exercise in Cooperation (1978)
  \item 世代別GCではない
  \item ZGCでも使われている
  \item エンタープライズ級のGCではない
  \end{itemize}
\end{frame}
\begin{frame}
  \frametitle{古典的なGCを採用した背景}
  {\large Go固有のランタイムがある}
\end{frame}
\begin{frame}
  \frametitle{局所的なメモリの割り当て}
  {\large フィールドは構造体に埋め込まれる}
\end{frame}
\begin{frame}
  \frametitle{interior pointer}
  {\large interiro pointerを使う間、構造体はメモリに残る}
\end{frame}
\section{On-the-Fly Garbage Collection}
\begin{frame}
  \frametitle{有向グラフによるヒープの表現}
  {\large ルートから到達できないノードをガベージとみなす}
  \begin{itemize}
  \item 大域やスタックの変数が参照する値はルート
  \item ガベージノードを白に着色
  \item 中間ノードを黒に着色
  \item ノード数は固定
  \end{itemize}
\end{frame}
\begin{frame}
  \frametitle{灰色がある理由}
  {\large 黒から白への有向辺がないことを保証したい}
\end{frame}
\begin{frame}
  \frametitle{証明を単純にするために}
  {\large 操作の種類を減らしたい}
  \begin{itemize}
    \item 操作の種類
  \end{itemize}
\end{frame}
\begin{frame}
  \frametitle{有向グラフを限定}
  {\large 出力のないノードをなくす}
  \par
  疑似終端ノード\texttt{NIL}でノードの出次数を2に限定
\end{frame}
\begin{frame}
  \frametitle{有向グラフを限定}
  {\large すべてを到達可能なノードにする}
  \begin{itemize}
  \item ルートノードでガベージノードのリストをつくる
  \end{itemize}
\end{frame}
\begin{frame}
  \frametitle{アプリケーション (mutator) の振る舞い}
  {\large 向き先のノードを灰色にして、有向辺の向き先を変える}
\end{frame}
\begin{frame}
  \frametitle{マーキングフェース}
  {\large 白い向き先を灰色にして、ノードを黒くする}
\end{frame}
\begin{frame}
  \frametitle{マーキングフェースの疑似コード}
  {\large ルートノードを灰色にする}
\end{frame}
\begin{frame}
  \frametitle{マーキングフェースの疑似コード}
  {\large 一巡しても灰色ノードがなければ終了}
\end{frame}
\begin{frame}
  \frametitle{アペンディングフェーズ}
  {\large 白ノードをリストに追加し、黒ノードを白にする}
  灰色はない
\end{frame}
\section{ガベージコレクションの実装}
\begin{frame}
  \frametitle{GCのフェーズ}
  {\large マーキングの終了時にSTWがある}
\end{frame}
\begin{frame}[allowframebreaks,t]
  \frametitle{参考資料}
  \printbibliography
  \nocite{*}
\end{frame}
\end{document}
